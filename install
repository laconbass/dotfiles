#!/usr/bin/env bash

# http://julipedia.meroh.net/2010/01/set-e-and-set-x.html
set -e


# Personal output functions

#COLS=$(( $(tput cols) - 4 ))
info () {
  printf "\033[00;34m${1}\033[0m\n"
}
warn () {
  printf "\033[0;33m${1}\033[0m\n"
}
doing () {
  printf "\033[00;34m*\033[0m ${1}...\n"
}
success () {
  #printf "\033[1C\033[${COLS}C\t\t\033[0;32mOK${1}\033[0m\n"
  printf "| - - - - - - - - - - - - - - - - -> \033[0;32mOK\033[0m\n"
  #printf "\t\t\t\t     \033[0;32mOK\n${1}\033[0m\n"
}
fail () {
  printf "| - - - - - - - - - - - - - - - -> \033[0;31mFAIL\033[0m\n" && exit 1
  # printf "\t\t\t\t   \033[0;31mFAIL\n${1}\033[0m\n" && exit 1
}

# checks whatever a system util is present
ensure_present () {
  doing "Ensuring package '$1' is present"\
  && type $1 >/dev/null 2>&1 && success\
  || (\
    warn "package '$1' not present."\
    && doing "Installing with apt-get"\
    && sudo apt-get install $1\
    || fail "Instalation of '$1' failed :S"\
  )
}


info ""
info "*** *** *** *** *** *** *** *** *** ***"
info "***************************************"
info "* @laconbass' dotfiles install script *"
info "***************************************"
info "*** *** *** *** *** *** *** *** *** ***"
info ""
info "***************************************"
info "***           preparation           ***"
info "**                                   **"

doing "updating git modules"\
 && git submodule update\
 && success\
 || fail ":S"

DOTFILES=$(pwd)

info "***************************************"
info "***           xterm utils           ***"
info "**                                   **"

doing "setting .bashrc file"\
 && cp "$DOTFILES/term/.bashrc" ~/\
 && success\
 || fail "sorry, aborting"

doing "loading .bashrc confs"\
 && source ~/.bashrc\
 || fail "something went wrong!"

doing "setting soralized palette for ls output"\
 && eval `dircolors "$DOTFILES/term/1-dircolors-solarized/dircolors.ansi-dark"`\
 && success\
 || fail "something went wrong"

doing "installing gnome-terminal-colors-solarized"\
 && echo ""\
 && cd $DOTFILES/term/2-gnome-terminal-solarized\
 && ./set_dark.sh\
 && cd $DOTFILES\
 && success\
 || fail

info "***************************************"
info "***        vim-related utils        ***"
info "**                                   **"

ensure_present "vim"

doing "setting .vimrc file"\
 && cp "$DOTFILES/vim/.vimrc" ~/\
 && success\
 || fail "sorry, aborting"

doing "deleting ~/.vim directory"\
 && rm -r ~/.vim\
 && success\
 || fail

doing "installing pathogen"\
 && mkdir -p ~/.vim/autoload\
 && ln -s "$DOTFILES/vim/1-pathogen/autoload/pathogen.vim"\
          ~/.vim/autoload/pathogen.vim\
 && mkdir -p ~/.vim/bundle\
 && success\
 || fail ":S"

doing "installing Node.vim"\
 && ln -s "$DOTFILES/vim/2-vim-node"\
          ~/.vim/bundle/node\
 && success\
 || fail ":S"

doing "installing solarized"\
 && ln -s "$DOTFILES/vim/3-solarized"\
          ~/.vim/bundle/solarized\
 && success\
 || fail ":S"

doing "fallando adrede" && fail ":S"
